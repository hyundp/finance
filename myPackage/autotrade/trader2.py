import ctypes
import sys
import time
from datetime import datetime

import pandas as pd
import win32com.client
from slacker import Slacker

slack = Slacker('xoxb-1472760183958-1479779745491-8x9UiIVNpIJ50RT9WUVYpDre')


def dbgout(message):
    """인자로 받은 문자열을 파이썬 셸과 슬랙으로 동시에 출력한다."""
    print(datetime.now().strftime('[%m/%d %H:%M:%S]'), message)
    strbuf = datetime.now().strftime('[%m/%d %H:%M:%S] ') + message
    slack.chat.post_message('invester', strbuf)


def printlog(message, *args):
    """인자로 받은 문자열을 파이썬 셸에 출력한다."""
    print(datetime.now().strftime('[%m/%d %H:%M:%S]'), message, *args)


# 크레온 플러스 공통 OBJECT
cpCodeMgr = win32com.client.Dispatch('CpUtil.CpStockCode')
cpStatus = win32com.client.Dispatch('CpUtil.CpCybos')
cpTradeUtil = win32com.client.Dispatch('CpTrade.CpTdUtil')
cpStock = win32com.client.Dispatch('DsCbo1.StockMst')
cpOhlc = win32com.client.Dispatch('CpSysDib.StockChart')
cpBalance = win32com.client.Dispatch('CpTrade.CpTd6033')
cpCash = win32com.client.Dispatch('CpTrade.CpTdNew5331A')
cpOrder = win32com.client.Dispatch('CpTrade.CpTd0311')


def check_creon_system():
    """크레온 플러스 시스템 연결 상태를 점검한다."""
    # 관리자 권한으로 프로세스 실행 여부
    if not ctypes.windll.shell32.IsUserAnAdmin():
        printlog('check_creon_system() : admin user -> FAILED')
        return False

    # 연결 여부 체크
    if (cpStatus.IsConnect == 0):
        printlog('check_creon_system() : connect to server -> FAILED')
        return False

    # 주문 관련 초기화 - 계좌 관련 코드가 있을 때만 사용
    if (cpTradeUtil.TradeInit(0) != 0):
        printlog('check_creon_system() : init trade -> FAILED')
        return False
    return True


def get_current_price(code):
    """인자로 받은 종목의 현재가, 매수호가, 매도호가를 반환한다."""
    cpStock.SetInputValue(0, code)  # 종목코드에 대한 가격 정보
    cpStock.BlockRequest()
    item = {}
    item['cur_price'] = cpStock.GetHeaderValue(11)  # 현재가
    item['ask'] = cpStock.GetHeaderValue(16)  # 매수호가
    item['bid'] = cpStock.GetHeaderValue(17)  # 매도호가
    return item['cur_price'], item['ask'], item['bid']


def get_ohlc(code, qty):
    """인자로 받은 종목의 OHLC 가격 정보를 qty 개수만큼 반환한다."""
    cpOhlc.SetInputValue(0, code)  # 종목코드
    cpOhlc.SetInputValue(1, ord('2'))  # 1:기간, 2:개수
    cpOhlc.SetInputValue(4, qty)  # 요청개수
    cpOhlc.SetInputValue(5, [0, 2, 3, 4, 5])  # 0:날짜, 2~5:OHLC
    cpOhlc.SetInputValue(6, ord('D'))  # D:일단위
    cpOhlc.SetInputValue(9, ord('1'))  # 0:무수정주가, 1:수정주가
    cpOhlc.BlockRequest()
    count = cpOhlc.GetHeaderValue(3)  # 3:수신개수
    columns = ['open', 'high', 'low', 'close']
    index = []
    rows = []
    for i in range(count):
        index.append(cpOhlc.GetDataValue(0, i))
        rows.append([cpOhlc.GetDataValue(1, i), cpOhlc.GetDataValue(2, i),
                     cpOhlc.GetDataValue(3, i), cpOhlc.GetDataValue(4, i)])
    df = pd.DataFrame(rows, columns=columns, index=index)
    return df


def get_stock_balance(code):
    """인자로 받은 종목의 종목명과 수량을 반환한다."""
    cpTradeUtil.TradeInit()
    acc = cpTradeUtil.AccountNumber[0]  # 계좌번호
    accFlag = cpTradeUtil.GoodsList(acc, 1)  # -1:전체, 1:주식, 2:선물/옵션
    cpBalance.SetInputValue(0, acc)  # 계좌번호
    cpBalance.SetInputValue(1, accFlag[0])  # 상품구분 - 주식 상품 중 첫번째
    cpBalance.SetInputValue(2, 50)  # 요청 건수(최대 50)
    cpBalance.BlockRequest()
    if code == 'ALL':
        dbgout('계좌명: ' + str(cpBalance.GetHeaderValue(0)))
        dbgout('결제잔고수량 : ' + str(cpBalance.GetHeaderValue(1)))
        dbgout('평가금액: ' + str(cpBalance.GetHeaderValue(3)))
        dbgout('평가손익: ' + str(cpBalance.GetHeaderValue(4)))
        dbgout('종목수: ' + str(cpBalance.GetHeaderValue(7)))
    stocks = []
    for i in range(cpBalance.GetHeaderValue(7)):
        stock_code = cpBalance.GetDataValue(12, i)  # 종목코드
        stock_name = cpBalance.GetDataValue(0, i)  # 종목명
        stock_qty = cpBalance.GetDataValue(15, i)  # 수량
        if code == 'ALL':
            dbgout(str(i + 1) + ' ' + stock_code + '(' + stock_name + ')'
                   + ':' + str(stock_qty))
            stocks.append({'code': stock_code, 'name': stock_name,
                           'qty': stock_qty})
        if stock_code == code:
            return stock_name, stock_qty
    if code == 'ALL':
        return stocks
    else:
        stock_name = cpCodeMgr.CodeToName(code)
        return stock_name, 0


def get_current_cash():
    """증거금 100% 주문 가능 금액을 반환한다."""
    cpTradeUtil.TradeInit()
    acc = cpTradeUtil.AccountNumber[0]  # 계좌번호
    accFlag = cpTradeUtil.GoodsList(acc, 1)  # -1:전체, 1:주식, 2:선물/옵션
    cpCash.SetInputValue(0, acc)  # 계좌번호
    cpCash.SetInputValue(1, accFlag[0])  # 상품구분 - 주식 상품 중 첫번째
    cpCash.BlockRequest()
    return cpCash.GetHeaderValue(9)  # 증거금 100% 주문 가능 금액


def get_target_price(code):
    """매수 목표가를 반환한다."""
    try:
        time_now = datetime.now()
        str_today = time_now.strftime('%Y%m%d')
        ohlc = get_ohlc(code, 10)
        if str_today == str(ohlc.iloc[0].name):
            today_open = ohlc.iloc[0].open
            lastday = ohlc.iloc[1]
        else:
            lastday = ohlc.iloc[0]
            today_open = lastday[3]
        target_price = today_open + (today_open * 0.17)
        return target_price
    except Exception as ex:
        dbgout("`get_target_price() -> exception! " + str(ex) + "`")
        return None


def buy_high(code):
    """인자로 받은 종목을 최유리 지정가 FOK 조건으로 매수한다."""
    try:
        global bought_list  # 함수 내에서 값 변경을 하기 위해 global로 지정
        if code in bought_list:  # 매수 완료 종목이면 더 이상 안 사도록 함수 종료
            # printlog('code:', code, 'in', bought_list)
            return False
        time_now = datetime.now()
        current_price, ask_price, bid_price = get_current_price(code)
        target_price = get_target_price(code)  # 매수 목표가
        buy_qty = 0  # 매수할 수량 초기화
        if ask_price > 0:  # 매수호가가 존재하면   
            buy_qty = buy_amount // ask_price
        stock_name, stock_qty = get_stock_balance(code)  # 종목명과 보유수량 조회
        # printlog('bought_list:', bought_list, 'len(bought_list):',
        #    len(bought_list), 'target_buy_count:', target_buy_count)     
        if current_price > target_price:
            printlog(stock_name + '(' + str(code) + ') ' + str(buy_qty) +
                     'EA : ' + str(current_price) + ' meets the buy condition!`')
            cpTradeUtil.TradeInit()
            acc = cpTradeUtil.AccountNumber[0]  # 계좌번호
            accFlag = cpTradeUtil.GoodsList(acc, 1)  # -1:전체,1:주식,2:선물/옵션
            # 최유리 IOC 매수 주문 설정
            cpOrder.SetInputValue(0, "2")  # 2: 매수
            cpOrder.SetInputValue(1, acc)  # 계좌번호
            cpOrder.SetInputValue(2, accFlag[0])  # 상품구분 - 주식 상품 중 첫번째
            cpOrder.SetInputValue(3, code)  # 종목코드
            cpOrder.SetInputValue(4, buy_qty)  # 매수할 수량
            cpOrder.SetInputValue(7, "1")  # 주문조건 0:기본, 1:IOC, 2:FOK
            cpOrder.SetInputValue(8, "12")  # 주문호가 1:보통, 3:시장가
            # 5:조건부, 12:최유리, 13:최우선
            # 매수 주문 요청
            ret = cpOrder.BlockRequest()
            printlog('최유리 IOC 매수 ->', stock_name, code, buy_qty, '->', ret)
            if ret == 4:
                remain_time = cpStatus.LimitRequestRemainTime
                printlog('주의: 연속 주문 제한에 걸림. 대기 시간:', remain_time / 1000)
                time.sleep(remain_time / 1000)
                return False
            time.sleep(2)
            printlog('현금주문 가능금액 :', buy_amount)
            stock_name, bought_qty = get_stock_balance(code)
            printlog('get_stock_balance :', stock_name, stock_qty)
            if bought_qty > 0:
                bought_list.append(code)
                dbgout("`buy_high(" + str(stock_name) + ' : ' + str(code) +
                       ") -> " + str(bought_qty) + "EA bought!" + "`")
    except Exception as ex:
        dbgout("`buy_high(" + str(code) + ") -> exception! " + str(ex) + "`")


def sell_all():
    """보유한 모든 종목을 최유리 지정가 IOC 조건으로 매도한다."""
    try:
        cpTradeUtil.TradeInit()
        acc = cpTradeUtil.AccountNumber[0]  # 계좌번호
        accFlag = cpTradeUtil.GoodsList(acc, 1)  # -1:전체, 1:주식, 2:선물/옵션   
        while True:
            stocks = get_stock_balance('ALL')
            total_qty = 0
            for s in stocks:
                total_qty += s['qty']
            if total_qty == 0:
                return True
            for s in stocks:
                if s['qty'] != 0:
                    cpOrder.SetInputValue(0, "1")  # 1:매도, 2:매수
                    cpOrder.SetInputValue(1, acc)  # 계좌번호
                    cpOrder.SetInputValue(2, accFlag[0])  # 주식상품 중 첫번째
                    cpOrder.SetInputValue(3, s['code'])  # 종목코드
                    cpOrder.SetInputValue(4, s['qty'])  # 매도수량
                    cpOrder.SetInputValue(7, "1")  # 조건 0:기본, 1:IOC, 2:FOK
                    cpOrder.SetInputValue(8, "12")  # 호가 12:최유리, 13:최우선 
                    # 최유리 IOC 매도 주문 요청
                    ret = cpOrder.BlockRequest()
                    printlog('최유리 IOC 매도', s['code'], s['name'], s['qty'],
                             '-> cpOrder.BlockRequest() -> returned', ret)
                    if ret == 4:
                        remain_time = cpStatus.LimitRequestRemainTime
                        printlog('주의: 연속 주문 제한, 대기시간:', remain_time / 1000)
                time.sleep(1)
            time.sleep(30)
    except Exception as ex:
        dbgout("sell_all() -> exception! " + str(ex))


if __name__ == '__main__':
    try:
        symbol_list = ['A000020', 'A000040', 'A000050', 'A000060', 'A000070', 'A000080', 'A000100', 'A000120',
                       'A000140', 'A000150', 'A000180', 'A000210', 'A000220',
                       'A000230', 'A000240', 'A000250', 'A000270', 'A000300', 'A000320', 'A000370', 'A000390',
                       'A000400', 'A000430', 'A000440', 'A000480', 'A000490',
                       'A000500', 'A000520', 'A000540', 'A000590', 'A000640', 'A000650', 'A000660', 'A000670',
                       'A000680', 'A000700', 'A000720', 'A000760', 'A000810',
                       'A000850', 'A000860', 'A000880', 'A000890', 'A000910', 'A000950', 'A000970', 'A000990',
                       'A001000', 'A001020', 'A001040', 'A001060', 'A001070',
                       'A001080', 'A001120', 'A001130', 'A001140', 'A001200', 'A001210', 'A001230', 'A001250',
                       'A001260', 'A001270', 'A001290', 'A001340', 'A001360',
                       'A001380', 'A001390', 'A001420', 'A001430', 'A001440', 'A001450', 'A001460', 'A001470',
                       'A001500', 'A001510', 'A001520', 'A001530', 'A001540',
                       'A001550', 'A001560', 'A001570', 'A001620', 'A001630', 'A001680', 'A001720', 'A001740',
                       'A001750', 'A001770', 'A001780', 'A001790', 'A001800',
                       'A001810', 'A001820', 'A001840', 'A001880', 'A001940', 'A002020', 'A002030', 'A002070',
                       'A002100', 'A002140', 'A002150', 'A002170', 'A002200',
                       'A002210', 'A002220', 'A002230', 'A002240', 'A002270', 'A002290', 'A002310', 'A002320',
                       'A002350', 'A002360', 'A002380', 'A002390', 'A002410',
                       'A002420', 'A002450', 'A002460', 'A002600', 'A002620', 'A002630', 'A002680', 'A002690',
                       'A002700', 'A002710', 'A002720', 'A002760', 'A002780',
                       'A002790', 'A002800', 'A002810', 'A002820', 'A002840', 'A002870', 'A002880', 'A002900',
                       'A002920', 'A002960', 'A002990', 'A003000', 'A003010',
                       'A003030', 'A003060', 'A003070', 'A003080', 'A003090', 'A003100', 'A003120', 'A003160',
                       'A003200', 'A003220', 'A003230', 'A003240', 'A003280',
                       'A003300', 'A003310', 'A003350', 'A003380', 'A003410', 'A003460', 'A003470', 'A003480',
                       'A003490', 'A003520', 'A003530', 'A003540', 'A003550',
                       'A003560', 'A003570', 'A003580', 'A003610', 'A003620', 'A003650', 'A003670', 'A003680',
                       'A003690', 'A003720', 'A003780', 'A003800', 'A003830',
                       'A003850', 'A003920', 'A003960', 'A004000', 'A004020', 'A004060', 'A004080', 'A004090',
                       'A004100', 'A004140', 'A004150', 'A004170', 'A004250',
                       'A004270', 'A004310', 'A004360', 'A004370', 'A004380', 'A004410', 'A004430', 'A004440',
                       'A004450', 'A004490', 'A004540', 'A004560', 'A004590',
                       'A004650', 'A004690', 'A004700', 'A004710', 'A004720', 'A004770', 'A004780', 'A004800',
                       'A004830', 'A004840', 'A004870', 'A004890', 'A004910',
                       'A004920', 'A004960', 'A004970', 'A004980', 'A004990', 'A005010', 'A005030', 'A005070',
                       'A005090', 'A005110', 'A005160', 'A005180', 'A005190',
                       'A005250', 'A005290', 'A005300', 'A005320', 'A005360', 'A005380', 'A005390', 'A005420',
                       'A005430', 'A005440', 'A005490', 'A005500', 'A005610',
                       'A005670', 'A005680', 'A005690', 'A005710', 'A005720', 'A005740', 'A005750', 'A005800',
                       'A005810', 'A005820', 'A005830', 'A005850', 'A005860',
                       'A005870', 'A005880', 'A005930', 'A005940', 'A005950', 'A005960', 'A005990', 'A006040',
                       'A006050', 'A006060', 'A006090', 'A006110', 'A006120',
                       'A006140', 'A006200', 'A006220', 'A006260', 'A006280', 'A006340', 'A006360', 'A006370',
                       'A006380', 'A006390', 'A006400', 'A006490', 'A006570',
                       'A006580', 'A006620', 'A006650', 'A006660', 'A006730', 'A006740', 'A006800', 'A006840',
                       'A006880', 'A006890', 'A006910', 'A006920', 'A006980',
                       'A007070', 'A007110', 'A007120', 'A007160', 'A007210', 'A007280', 'A007310', 'A007330',
                       'A007340', 'A007370', 'A007390', 'A007460', 'A007530',
                       'A007540', 'A007570', 'A007590', 'A007610', 'A007630', 'A007660', 'A007680', 'A007690',
                       'A007700', 'A007720', 'A007770', 'A007810', 'A007820',
                       'A007860', 'A007980', 'A008040', 'A008060', 'A008110', 'A008250', 'A008260', 'A008290',
                       'A008350', 'A008370', 'A008420', 'A008470', 'A008490',
                       'A008500', 'A008560', 'A008600', 'A008700', 'A008730', 'A008770', 'A008800', 'A008830',
                       'A008870', 'A008930', 'A008970', 'A009070', 'A009140',
                       'A009150', 'A009160', 'A009180', 'A009190', 'A009200', 'A009240', 'A009270', 'A009290',
                       'A009300', 'A009310', 'A009320', 'A009410', 'A009420',
                       'A009440', 'A009450', 'A009460', 'A009470', 'A009520', 'A009540', 'A009580', 'A009620',
                       'A009680', 'A009730', 'A009770', 'A009780', 'A009810',
                       'A009830', 'A009970', 'A010040', 'A010050', 'A010060', 'A010100', 'A010120', 'A010130',
                       'A010140', 'A010170', 'A010240', 'A010280', 'A010400',
                       'A010420', 'A010470', 'A010580', 'A010600', 'A010620', 'A010640', 'A010660', 'A010690',
                       'A010770', 'A010780', 'A010820', 'A010950', 'A010960',
                       'A011000', 'A011040', 'A011070', 'A011080', 'A011090', 'A011150', 'A011170', 'A011200',
                       'A011210', 'A011230', 'A011280', 'A011300', 'A011320',
                       'A011330', 'A011370', 'A011390', 'A011420', 'A011500', 'A011560', 'A011690', 'A011700',
                       'A011760', 'A011780', 'A011790', 'A011810', 'A011930',
                       'A012030', 'A012160', 'A012170', 'A012200', 'A012280', 'A012320', 'A012330', 'A012340',
                       'A012450', 'A012510', 'A012600', 'A012610', 'A012620',
                       'A012630', 'A012690', 'A012700', 'A012750', 'A012790', 'A012800', 'A012860', 'A013000',
                       'A013030', 'A013120', 'A013310', 'A013360', 'A013520',
                       'A013570', 'A013580', 'A013700', 'A013720', 'A013810', 'A013870', 'A013890', 'A013990',
                       'A014100', 'A014130', 'A014160', 'A014190', 'A014200',
                       'A014280', 'A014440', 'A014470', 'A014530', 'A014570', 'A014580', 'A014620', 'A014680',
                       'A014710', 'A014790', 'A014820', 'A014830', 'A014910',
                       'A014940', 'A014970', 'A014990', 'A015020', 'A015230', 'A015260', 'A015350', 'A015360',
                       'A015540', 'A015590', 'A015710', 'A015750', 'A015760',
                       'A015860', 'A015890', 'A016090', 'A016100', 'A016250', 'A016360', 'A016380', 'A016450',
                       'A016580', 'A016590', 'A016600', 'A016610', 'A016670',
                       'A016710', 'A016740', 'A016790', 'A016800', 'A016880', 'A016920', 'A017000', 'A017040',
                       'A017180', 'A017250', 'A017370', 'A017390', 'A017480',
                       'A017510', 'A017550', 'A017650', 'A017670', 'A017800', 'A017810', 'A017890', 'A017900',
                       'A017940', 'A017960', 'A018000', 'A018120', 'A018250',
                       'A018260', 'A018290', 'A018310', 'A018470', 'A018500', 'A018620', 'A018670', 'A018680',
                       'A018700', 'A018880', 'A019010', 'A019170', 'A019180',
                       'A019210', 'A019440', 'A019490', 'A019540', 'A019550', 'A019570', 'A019590', 'A019660',
                       'A019680', 'A019770', 'A019990', 'A020000', 'A020120',
                       'A020150', 'A020180', 'A020400', 'A020560', 'A020710', 'A020760', 'A021040', 'A021050',
                       'A021080', 'A021240', 'A021320', 'A021650', 'A021820',
                       'A021880', 'A022100', 'A022220', 'A023000', 'A023150', 'A023160', 'A023350', 'A023410',
                       'A023440', 'A023450', 'A023460', 'A023530', 'A023590',
                       'A023600', 'A023760', 'A023770', 'A023790', 'A023800', 'A023810', 'A023890', 'A023900',
                       'A023910', 'A023960', 'A024060', 'A024070', 'A024090',
                       'A024110', 'A024120', 'A024720', 'A024740', 'A024800', 'A024810', 'A024830', 'A024840',
                       'A024850', 'A024880', 'A024890', 'A024900', 'A024910',
                       'A024940', 'A024950', 'A025000', 'A025320', 'A025440', 'A025530', 'A025540', 'A025550',
                       'A025560', 'A025620', 'A025750', 'A025770', 'A025820',
                       'A025860', 'A025870', 'A025880', 'A025890', 'A025900', 'A025950', 'A025980', 'A026040',
                       'A026150', 'A026890', 'A026910', 'A026940', 'A026960',
                       'A027040', 'A027050', 'A027360', 'A027410', 'A027580', 'A027710', 'A027740', 'A027830',
                       'A027970', 'A028040', 'A028050', 'A028080', 'A028100',
                       'A028150', 'A028260', 'A028300', 'A028670', 'A029460', 'A029480', 'A029530', 'A029780',
                       'A029960', 'A030000', 'A030190', 'A030200', 'A030210',
                       'A030350', 'A030520', 'A030530', 'A030610', 'A030720', 'A030790', 'A030960', 'A031310',
                       'A031330', 'A031390', 'A031430', 'A031440', 'A031510',
                       'A031820', 'A031860', 'A031980', 'A032080', 'A032190', 'A032280', 'A032300', 'A032350',
                       'A032500', 'A032540', 'A032560', 'A032580', 'A032620',
                       'A032640', 'A032680', 'A032750', 'A032790', 'A032800', 'A032820', 'A032830', 'A032850',
                       'A032860', 'A032940', 'A032960', 'A032980', 'A033050',
                       'A033100', 'A033110', 'A033130', 'A033160', 'A033170', 'A033180', 'A033200', 'A033230',
                       'A033240', 'A033250', 'A033270', 'A033290', 'A033310',
                       'A033320', 'A033340', 'A033430', 'A033500', 'A033530', 'A033540', 'A033560', 'A033600',
                       'A033640', 'A033660', 'A033780', 'A033790', 'A033830',
                       'A033920', 'A034020', 'A034120', 'A034220', 'A034230', 'A034300', 'A034310', 'A034590',
                       'A034730', 'A034810', 'A034830', 'A034940', 'A034950',
                       'A035000', 'A035080', 'A035150', 'A035200', 'A035250', 'A035290', 'A035420', 'A035460',
                       'A035510', 'A035600', 'A035610', 'A035620', 'A035720',
                       'A035760', 'A035810', 'A035890', 'A035900', 'A036000', 'A036010', 'A036030', 'A036090',
                       'A036120', 'A036170', 'A036180', 'A036190', 'A036200',
                       'A036260', 'A036420', 'A036460', 'A036480', 'A036490', 'A036530', 'A036540', 'A036560',
                       'A036570', 'A036580', 'A036620', 'A036630', 'A036640',
                       'A036670', 'A036690', 'A036710', 'A036800', 'A036810', 'A036830', 'A036890', 'A036930',
                       'A037030', 'A037070', 'A037230', 'A037270', 'A037330',
                       'A037350', 'A037370', 'A037400', 'A037440', 'A037460', 'A037560', 'A037710', 'A037760',
                       'A037950', 'A038010', 'A038060', 'A038070', 'A038110',
                       'A038160', 'A038290', 'A038340', 'A038390', 'A038460', 'A038500', 'A038530', 'A038540',
                       'A038620', 'A038680', 'A038870', 'A038880', 'A038950',
                       'A039010', 'A039020', 'A039030', 'A039130', 'A039200', 'A039230', 'A039240', 'A039290',
                       'A039310', 'A039340', 'A039420', 'A039440', 'A039490',
                       'A039560', 'A039570', 'A039610', 'A039670', 'A039740', 'A039830', 'A039840', 'A039860',
                       'A039980', 'A040160', 'A040300', 'A040350', 'A040420',
                       'A040610', 'A040910', 'A041020', 'A041140', 'A041190', 'A041440', 'A041460', 'A041510',
                       'A041520', 'A041590', 'A041650', 'A041830', 'A041910',
                       'A041920', 'A041930', 'A041960', 'A042000', 'A042040', 'A042110', 'A042370', 'A042420',
                       'A042500', 'A042510', 'A042520', 'A042600', 'A042660',
                       'A042670', 'A042700', 'A042940', 'A043090', 'A043100', 'A043150', 'A043200', 'A043220',
                       'A043260', 'A043290', 'A043340', 'A043360', 'A043370',
                       'A043590', 'A043610', 'A043650', 'A043710', 'A043910', 'A044060', 'A044180', 'A044340',
                       'A044380', 'A044450', 'A044480', 'A044490', 'A044780',
                       'A044820', 'A044960', 'A044990', 'A045060', 'A045100', 'A045300', 'A045340', 'A045390',
                       'A045510', 'A045520', 'A045660', 'A045890', 'A045970',
                       'A046070', 'A046110', 'A046120', 'A046140', 'A046210', 'A046310', 'A046390', 'A046440',
                       'A046890', 'A046940', 'A046970', 'A047040', 'A047050',
                       'A047080', 'A047310', 'A047400', 'A047560', 'A047770', 'A047810', 'A047820', 'A047920',
                       'A048260', 'A048410', 'A048430', 'A048470', 'A048530',
                       'A048550', 'A048770', 'A048830', 'A048870', 'A048910', 'A049070', 'A049080', 'A049120',
                       'A049180', 'A049430', 'A049470', 'A049480', 'A049520',
                       'A049550', 'A049630', 'A049720', 'A049770', 'A049800', 'A049830', 'A049950', 'A049960',
                       'A050090', 'A050110', 'A050120', 'A050320', 'A050540',
                       'A050760', 'A050860', 'A050890', 'A050960', 'A051160', 'A051360', 'A051370', 'A051380',
                       'A051390', 'A051490', 'A051500', 'A051600', 'A051630',
                       'A051780', 'A051900', 'A051910', 'A051980', 'A052020', 'A052190', 'A052220', 'A052260',
                       'A052300', 'A052330', 'A052400', 'A052420', 'A052460',
                       'A052600', 'A052670', 'A052690', 'A052710', 'A052770', 'A052790', 'A052860', 'A052900',
                       'A053030', 'A053050', 'A053060', 'A053080', 'A053110',
                       'A053160', 'A053210', 'A053260', 'A053270', 'A053280', 'A053290', 'A053300', 'A053350',
                       'A053450', 'A053580', 'A053590', 'A053610', 'A053620',
                       'A053660', 'A053690', 'A053700', 'A053800', 'A053950', 'A053980', 'A054040', 'A054050',
                       'A054090', 'A054180', 'A054210', 'A054220', 'A054300',
                       'A054410', 'A054450', 'A054540', 'A054620', 'A054630', 'A054670', 'A054780', 'A054800',
                       'A054920', 'A054930', 'A054940', 'A054950', 'A055490',
                       'A055550', 'A056000', 'A056080', 'A056090', 'A056190', 'A056360', 'A056700', 'A056730',
                       'A057030', 'A057050', 'A057500', 'A057540', 'A057680',
                       'A057880', 'A058110', 'A058220', 'A058400', 'A058420', 'A058430', 'A058450', 'A058470',
                       'A058530', 'A058610', 'A058630', 'A058650', 'A058730',
                       'A058820', 'A058850', 'A058860', 'A058970', 'A059090', 'A059100', 'A059120', 'A059210',
                       'A060150', 'A060230', 'A060240', 'A060250', 'A060260',
                       'A060280', 'A060300', 'A060310', 'A060370', 'A060380', 'A060480', 'A060540', 'A060560',
                       'A060570', 'A060590', 'A060720', 'A060850', 'A060900',
                       'A060980', 'A061040', 'A061250', 'A061970', 'A062860', 'A062970', 'A063080', 'A063160',
                       'A063170', 'A063440', 'A063570', 'A063760', 'A064090',
                       'A064240', 'A064260', 'A064290', 'A064350', 'A064480', 'A064510', 'A064520', 'A064550',
                       'A064760', 'A064800', 'A064820', 'A064850', 'A064960',
                       'A065060', 'A065130', 'A065150', 'A065170', 'A065350', 'A065370', 'A065420', 'A065440',
                       'A065450', 'A065500', 'A065510', 'A065530', 'A065560',
                       'A065570', 'A065620', 'A065650', 'A065660', 'A065680', 'A065690', 'A065710', 'A065770',
                       'A065950', 'A066110', 'A066130', 'A066310', 'A066360',
                       'A066410', 'A066430', 'A066570', 'A066590', 'A066620', 'A066670', 'A066700', 'A066790',
                       'A066830', 'A066900', 'A066910', 'A066970', 'A066980',
                       'A067000', 'A067010', 'A067080', 'A067160', 'A067170', 'A067280', 'A067290', 'A067310',
                       'A067370', 'A067390', 'A067570', 'A067630', 'A067730',
                       'A067770', 'A067830', 'A067900', 'A067920', 'A067990', 'A068050', 'A068240', 'A068270',
                       'A068290', 'A068330', 'A068400', 'A068760', 'A068790',
                       'A068930', 'A068940', 'A069080', 'A069110', 'A069140', 'A069260', 'A069330', 'A069410',
                       'A069460', 'A069510', 'A069540', 'A069620', 'A069640',
                       'A069730', 'A069920', 'A069960', 'A070300', 'A070590', 'A070960', 'A071050', 'A071090',
                       'A071200', 'A071280', 'A071320', 'A071460', 'A071670',
                       'A071840', 'A071850', 'A071950', 'A071970', 'A072020', 'A072130', 'A072470', 'A072520',
                       'A072710', 'A072770', 'A072870', 'A072950', 'A072990',
                       'A073010', 'A073070', 'A073110', 'A073190', 'A073240', 'A073490', 'A073540', 'A073560',
                       'A073570', 'A073640', 'A074430', 'A074600', 'A074610',
                       'A075130', 'A075180', 'A075580', 'A075970', 'A076080', 'A076340', 'A076610', 'A077360',
                       'A077500', 'A077970', 'A078000', 'A078020', 'A078070',
                       'A078130', 'A078140', 'A078150', 'A078160', 'A078340', 'A078350', 'A078520', 'A078590',
                       'A078600', 'A078650', 'A078860', 'A078890', 'A078930',
                       'A078940', 'A079000', 'A079160', 'A079170', 'A079190', 'A079370', 'A079430', 'A079550',
                       'A079650', 'A079810', 'A079940', 'A079950', 'A079960',
                       'A079970', 'A079980', 'A080000', 'A080010', 'A080160', 'A080220', 'A080420', 'A080440',
                       'A080470', 'A080520', 'A080530', 'A080580', 'A080720',
                       'A081000', 'A081150', 'A081580', 'A081660', 'A082210', 'A082270', 'A082640', 'A082660',
                       'A082740', 'A082800', 'A082850', 'A082920', 'A083310',
                       'A083420', 'A083450', 'A083470', 'A083500', 'A083550', 'A083640', 'A083650', 'A083660',
                       'A083790', 'A083930', 'A084010', 'A084110', 'A084180',
                       'A084370', 'A084440', 'A084650', 'A084670', 'A084680', 'A084690', 'A084730', 'A084850',
                       'A084870', 'A084990', 'A085310', 'A085370', 'A085620',
                       'A085660', 'A085670', 'A085810', 'A085910', 'A086040', 'A086060', 'A086080', 'A086220',
                       'A086250', 'A086280', 'A086390', 'A086450', 'A086460',
                       'A086520', 'A086670', 'A086790', 'A086820', 'A086890', 'A086900', 'A086960', 'A086980',
                       'A087010', 'A087260', 'A087600', 'A087730', 'A088130',
                       'A088260', 'A088290', 'A088350', 'A088390', 'A088790', 'A088800', 'A088910', 'A088980',
                       'A089010', 'A089030', 'A089140', 'A089150', 'A089230',
                       'A089470', 'A089530', 'A089590', 'A089600', 'A089790', 'A089850', 'A089890', 'A089970',
                       'A089980', 'A090080', 'A090150', 'A090350', 'A090360',
                       'A090370', 'A090410', 'A090430', 'A090460', 'A090470', 'A090710', 'A090740', 'A090850',
                       'A091090', 'A091120', 'A091340', 'A091440', 'A091580',
                       'A091590', 'A091700', 'A091810', 'A091970', 'A091990', 'A092040', 'A092070', 'A092130',
                       'A092190', 'A092200', 'A092220', 'A092230', 'A092300',
                       'A092440', 'A092460', 'A092590', 'A092600', 'A092730', 'A092780', 'A092870', 'A093050',
                       'A093190', 'A093230', 'A093240', 'A093320', 'A093370',
                       'A093380', 'A093510', 'A093520', 'A093640', 'A093920', 'A094170', 'A094280', 'A094360',
                       'A094480', 'A094800', 'A094820', 'A094840', 'A094850',
                       'A094860', 'A094940', 'A094970', 'A095190', 'A095270', 'A095340', 'A095500', 'A095570',
                       'A095610', 'A095660', 'A095700', 'A095720', 'A095910',
                       'A096040', 'A096240', 'A096300', 'A096350', 'A096530', 'A096610', 'A096630', 'A096640',
                       'A096690', 'A096760', 'A096770', 'A096870', 'A097230',
                       'A097520', 'A097780', 'A097800', 'A097870', 'A097950', 'A098120', 'A098460', 'A098660',
                       'A099190', 'A099220', 'A099320', 'A099410', 'A099440',
                       'A099520', 'A099750', 'A100030', 'A100090', 'A100120', 'A100130', 'A100220', 'A100250',
                       'A100590', 'A100660', 'A100700', 'A100790', 'A100840',
                       'A101000', 'A101060', 'A101140', 'A101160', 'A101170', 'A101240', 'A101330', 'A101360',
                       'A101390', 'A101400', 'A101490', 'A101530', 'A101670',
                       'A101680', 'A101730', 'A101930', 'A102120', 'A102210', 'A102260', 'A102280', 'A102460',
                       'A102710', 'A102940', 'A103140', 'A103230', 'A103590',
                       'A103660', 'A103840', 'A104040', 'A104200', 'A104460', 'A104480', 'A104540', 'A104620',
                       'A104700', 'A104830', 'A105330', 'A105550', 'A105560',
                       'A105630', 'A105740', 'A105840', 'A106080', 'A106190', 'A106240', 'A106520', 'A107590',
                       'A107640', 'A108230', 'A108320', 'A108380', 'A108490',
                       'A108670', 'A108860', 'A109070', 'A109080', 'A109610', 'A109740', 'A109820', 'A109860',
                       'A109960', 'A110020', 'A110790', 'A110990', 'A111110',
                       'A111710', 'A111770', 'A111820', 'A111870', 'A112040', 'A112190', 'A112610', 'A113810',
                       'A114090', 'A114120', 'A114190', 'A114450', 'A114570',
                       'A114630', 'A114810', 'A114920', 'A115160', 'A115180', 'A115310', 'A115390', 'A115440',
                       'A115450', 'A115480', 'A115500', 'A115530', 'A115570',
                       'A115610', 'A115960', 'A116100', 'A117580', 'A117670', 'A117730', 'A118000', 'A118990',
                       'A119500', 'A119610', 'A119650', 'A119830', 'A119850',
                       'A119860', 'A120030', 'A120110', 'A120240', 'A120780', 'A121060', 'A121440', 'A121600',
                       'A121800', 'A121850', 'A121890', 'A122310', 'A122350',
                       'A122450', 'A122640', 'A122690', 'A122830', 'A122870', 'A122900', 'A122990', 'A123010',
                       'A123040', 'A123330', 'A123410', 'A123420', 'A123570',
                       'A123690', 'A123700', 'A123750', 'A123840', 'A123860', 'A123890', 'A124500', 'A124560',
                       'A125210', 'A126340', 'A126560', 'A126600', 'A126640',
                       'A126700', 'A126870', 'A126880', 'A127120', 'A127160', 'A127710', 'A128540', 'A128660',
                       'A128820', 'A128940', 'A129260', 'A130500', 'A130580',
                       'A130660', 'A130740', 'A131030', 'A131090', 'A131100', 'A131180', 'A131220', 'A131290',
                       'A131370', 'A131390', 'A131400', 'A131760', 'A131970',
                       'A133750', 'A133820', 'A134060', 'A134380', 'A134580', 'A134790', 'A135160', 'A136480',
                       'A136490', 'A136510', 'A136540', 'A136660', 'A137400',
                       'A137940', 'A137950', 'A138040', 'A138070', 'A138080', 'A138250', 'A138360', 'A138490',
                       'A138580', 'A138610', 'A138690', 'A138930', 'A139050',
                       'A139130', 'A139480', 'A139670', 'A140070', 'A140290', 'A140410', 'A140520', 'A140610',
                       'A140660', 'A140670', 'A140860', 'A140910', 'A141000',
                       'A141020', 'A141070', 'A141080', 'A142210', 'A142280', 'A142760', 'A143160', 'A143210',
                       'A143240', 'A143540', 'A144510', 'A144620', 'A144960',
                       'A145020', 'A145210', 'A145270', 'A145720', 'A145990', 'A147760', 'A147830', 'A148140',
                       'A148150', 'A148250', 'A148780', 'A149010', 'A149300',
                       'A149950', 'A149980', 'A150440', 'A150840', 'A150900', 'A151860', 'A151910', 'A152330',
                       'A152550', 'A153360', 'A153460', 'A153490', 'A153710',
                       'A154030', 'A154040', 'A155650', 'A155660', 'A155900', 'A156100', 'A158300', 'A158310',
                       'A158430', 'A159580', 'A159910', 'A160550', 'A160600',
                       'A160980', 'A161000', 'A161390', 'A161570', 'A161580', 'A161890', 'A162120', 'A163430',
                       'A163560', 'A164060', 'A166090', 'A166480', 'A168330',
                       'A168490', 'A169330', 'A170030', 'A170790', 'A170900', 'A170920', 'A171010', 'A171090',
                       'A171120', 'A172580', 'A173130', 'A173940', 'A174880',
                       'A174900', 'A175140', 'A175250', 'A175330', 'A176440', 'A176750', 'A177350', 'A177830',
                       'A178320', 'A178600', 'A178780', 'A178920', 'A179290',
                       'A179530', 'A179720', 'A179900', 'A180060', 'A180400', 'A180640', 'A181340', 'A181710',
                       'A182360', 'A182400', 'A182690', 'A183190', 'A183300',
                       'A183410', 'A183490', 'A184230', 'A185190', 'A185490', 'A185750', 'A186230', 'A187220',
                       'A187270', 'A187420', 'A187790', 'A187870', 'A189300',
                       'A189330', 'A189350', 'A189690', 'A189860', 'A189980', 'A190510', 'A190650', 'A191410',
                       'A191420', 'A191600', 'A192080', 'A192250', 'A192390',
                       'A192400', 'A192410', 'A192440', 'A192650', 'A192820', 'A193250', 'A194370', 'A194480',
                       'A194700', 'A195440', 'A195500', 'A195870', 'A195990',
                       'A196170', 'A196300', 'A196450', 'A196490', 'A196700', 'A197140', 'A198080', 'A198440',
                       'A199150', 'A199290', 'A199800', 'A200130', 'A200230',
                       'A200350', 'A200470', 'A200580', 'A200670', 'A200710', 'A200780', 'A200880', 'A201490',
                       'A202960', 'A203400', 'A203450', 'A203650', 'A203690',
                       'A204020', 'A204210', 'A204270', 'A204320', 'A204620', 'A204630', 'A204840', 'A205100',
                       'A205470', 'A205500', 'A206400', 'A206560', 'A206640',
                       'A206650', 'A206950', 'A207490', 'A207760', 'A207940', 'A208140', 'A208340', 'A208350',
                       'A208370', 'A208640', 'A208710', 'A208850', 'A208860',
                       'A208890', 'A210120', 'A210540', 'A210980', 'A211050', 'A211270', 'A212310', 'A212560',
                       'A213090', 'A213420', 'A213500', 'A214150', 'A214180',
                       'A214260', 'A214270', 'A214310', 'A214320', 'A214330', 'A214370', 'A214390', 'A214420',
                       'A214430', 'A214450', 'A214610', 'A214680', 'A214870',
                       'A215000', 'A215050', 'A215090', 'A215100', 'A215200', 'A215360', 'A215380', 'A215480',
                       'A215570', 'A215600', 'A215790', 'A216050', 'A216080',
                       'A216280', 'A216400', 'A217190', 'A217270', 'A217320', 'A217330', 'A217480', 'A217500',
                       'A217600', 'A217620', 'A217730', 'A217820', 'A217880',
                       'A217910', 'A217950', 'A218150', 'A218410', 'A219130', 'A219420', 'A219550', 'A219750',
                       'A220100', 'A220180', 'A220260', 'A220630', 'A221610',
                       'A221800', 'A221840', 'A221980', 'A222040', 'A222080', 'A222110', 'A222160', 'A222420',
                       'A222670', 'A222800', 'A222810', 'A222980', 'A223220',
                       'A223250', 'A223310', 'A224020', 'A224060', 'A224110', 'A224760', 'A224810', 'A224880',
                       'A225190', 'A225220', 'A225330', 'A225430', 'A225530',
                       'A225570', 'A225590', 'A225850', 'A225860', 'A226320', 'A226330', 'A226340', 'A226350',
                       'A226360', 'A226400', 'A226440', 'A226950', 'A227100',
                       'A227420', 'A227610', 'A227840', 'A227950', 'A228340', 'A228670', 'A228760', 'A228850',
                       'A229000', 'A229500', 'A229640', 'A230240', 'A230360',
                       'A230980', 'A232140', 'A232530', 'A232680', 'A232830', 'A233250', 'A233990', 'A234070',
                       'A234080', 'A234100', 'A234300', 'A234340', 'A234690',
                       'A234920', 'A235980', 'A236030', 'A236200', 'A236340', 'A237690', 'A237750', 'A237820',
                       'A237880', 'A238090', 'A238120', 'A238170', 'A238200',
                       'A238490', 'A238500', 'A239340', 'A239610', 'A239890', 'A240340', 'A240810', 'A241510',
                       'A241520', 'A241560', 'A241590', 'A241690', 'A241710',
                       'A241770', 'A241790', 'A241820', 'A241840', 'A242040', 'A242350', 'A243070', 'A243840',
                       'A243870', 'A244460', 'A244880', 'A245450', 'A245620',
                       'A246250', 'A246690', 'A246710', 'A246720', 'A246960', 'A247540', 'A248170', 'A249420',
                       'A250000', 'A250030', 'A250060', 'A250930', 'A251270',
                       'A251280', 'A251370', 'A251630', 'A251960', 'A251970', 'A252500', 'A253450', 'A253590',
                       'A253840', 'A254120', 'A255220', 'A255440', 'A256150',
                       'A256630', 'A256840', 'A256940', 'A257370', 'A258050', 'A258250', 'A258540', 'A258610',
                       'A258790', 'A258830', 'A259630', 'A260660', 'A260870',
                       'A260930', 'A260970', 'A261200', 'A262260', 'A263020', 'A263050', 'A263540', 'A263600',
                       'A263690', 'A263700', 'A263720', 'A263750', 'A263770',
                       'A263800', 'A263810', 'A263860', 'A263920', 'A264450', 'A264660', 'A264850', 'A264900',
                       'A265520', 'A265560', 'A266170', 'A266470', 'A266870',
                       'A267060', 'A267250', 'A267260', 'A267270', 'A267290', 'A267320', 'A267790', 'A267810',
                       'A267850', 'A267980', 'A268280', 'A268600', 'A269620',
                       'A270020', 'A270210', 'A270520', 'A270660', 'A270870', 'A271560', 'A271850', 'A271980',
                       'A272110', 'A272210', 'A272290', 'A272450', 'A272550',
                       'A273060', 'A274090', 'A275630', 'A276240', 'A277070', 'A277410', 'A277880', 'A278280',
                       'A278380', 'A278650', 'A278990', 'A279060', 'A279600',
                       'A280360', 'A281310', 'A281740', 'A281820', 'A282330', 'A282690', 'A282880', 'A284420',
                       'A284610', 'A284620', 'A284740', 'A285130', 'A285490',
                       'A285770', 'A286750', 'A286940', 'A287410', 'A288330', 'A288490', 'A288620', 'A289010',
                       'A289080', 'A290120', 'A290270', 'A290380', 'A290510',
                       'A290520', 'A290550', 'A290650', 'A290660', 'A290670', 'A290690', 'A290720', 'A290740',
                       'A291210', 'A291230', 'A291650', 'A293480', 'A293490',
                       'A293580', 'A293780', 'A293940', 'A294090', 'A294140', 'A294630', 'A294870', 'A297090',
                       'A297570', 'A297890', 'A298000', 'A298020', 'A298040',
                       'A298050', 'A298060', 'A298380', 'A298540', 'A298690', 'A299170', 'A299480', 'A299660',
                       'A299670', 'A299900', 'A299910', 'A300080', 'A300120',
                       'A300720', 'A301300', 'A302430', 'A302550', 'A302920', 'A303030', 'A303360', 'A304100',
                       'A304840', 'A305090', 'A306040', 'A306200', 'A306620',
                       'A307070', 'A307160', 'A307180', 'A307280', 'A307750', 'A307870', 'A307930', 'A307950',
                       'A308100', 'A308170', 'A308700', 'A309900', 'A309930',
                       'A310200', 'A310840', 'A310870', 'A311060', 'A311270', 'A311390', 'A311690', 'A312610',
                       'A313750', 'A313760', 'A314130', 'A316140', 'A317030',
                       'A317120', 'A317240', 'A317320', 'A317330', 'A317400', 'A317530', 'A317770', 'A317830',
                       'A317850', 'A317860', 'A317870', 'A318000', 'A318010',
                       'A318410', 'A319400', 'A319660', 'A320000', 'A321260', 'A321550', 'A322000', 'A322180',
                       'A322510', 'A322780', 'A322970', 'A323210', 'A323230',
                       'A323280', 'A323350', 'A323940', 'A323990', 'A326030', 'A327260', 'A327610', 'A327970',
                       'A328380', 'A329020', 'A329050', 'A329560', 'A330350',
                       'A330590', 'A330990', 'A331380', 'A331520', 'A331660', 'A331920', 'A332290', 'A332370',
                       'A332570', 'A332710', 'A333050', 'A333430', 'A334890',
                       'A335870', 'A335890', 'A336040', 'A336060', 'A336260', 'A336370', 'A336570', 'A337450',
                       'A337840', 'A337930', 'A338100', 'A339950', 'A340120',
                       'A340350', 'A340360', 'A340440', 'A341160', 'A341310', 'A342550', 'A343090', 'A343510',
                       'A344050', 'A344820', 'A344860', 'A347000', 'A347140',
                       'A347740', 'A347770', 'A347890', 'A348210', 'A348350', 'A348840', 'A348950', 'A349720',
                       'A350520', 'A351320', 'A351340', 'A352820', 'A353070',
                       'A353190', 'A353200', 'A353490', 'A353810', 'A354230', 'A355150', 'A357120', 'A357250',
                       'A357780', 'A359090', 'A363280', 'A900070', 'A900080',
                       'A900100', 'A900110', 'A900120', 'A900140', 'A900250', 'A900260', 'A900270', 'A900280',
                       'A900290', 'A900300', 'A900310', 'A900340', 'A950110',
                       'A950130', 'A950140', 'A950160', 'A950170', 'A950180', 'A950190', 'A950200']
        bought_list = []  # 매수 완료된 종목 리스트
        target_buy_count = 10  # 매수할 종목 수
        buy_percent = 0.01
        printlog('check_creon_system() :', check_creon_system())  # 크레온 접속 점검
        stocks = get_stock_balance('ALL')  # 보유한 모든 종목 조회
        total_cash = int(get_current_cash())  # 100% 증거금 주문 가능 금액 조회
        buy_amount = total_cash * buy_percent  # 종목별 주문 금액 계산
        printlog('100% 증거금 주문 가능 금액 :', total_cash)
        printlog('종목별 주문 비율 :', buy_percent)
        printlog('종목별 주문 금액 :', buy_amount)
        printlog('시작 시간 :', datetime.now().strftime('%m/%d %H:%M:%S'))
        soldout = False;

        while True:
            t_now = datetime.now()
            t_9 = t_now.replace(hour=9, minute=0, second=0, microsecond=0)
            t_start = t_now.replace(hour=9, minute=5, second=0, microsecond=0)
            t_sell = t_now.replace(hour=15, minute=15, second=0, microsecond=0)
            t_exit = t_now.replace(hour=15, minute=20, second=0, microsecond=0)
            today = datetime.today().weekday()
            if today == 5 or today == 6:  # 토요일이나 일요일이면 자동 종료
                printlog('Today is', 'Saturday.' if today == 5 else 'Sunday.')
                time.sleep(5)
                sys.exit(0)
            if t_9 < t_now < t_start and soldout == False:
                soldout = True
                sell_all()
            if t_start < t_now < t_sell:  # AM 09:05 ~ PM 03:15 : 매수
                for sym in symbol_list:
                    if len(bought_list) < target_buy_count:
                        buy_high(sym)
                        time.sleep(1)
                if t_now.minute == 30 and 0 <= t_now.second <= 5:
                    get_stock_balance('ALL')
                    time.sleep(5)
            if t_sell < t_now < t_exit:  # PM 03:15 ~ PM 03:20 : 일괄 매도
                if sell_all() == True:
                    dbgout('`sell_all() returned True -> self-destructed!`')
                    sys.exit(0)
            if t_exit < t_now:  # PM 03:20 ~ :프로그램 종료
                dbgout('`self-destructed!`')
                time.sleep(5)
                sys.exit(0)
            time.sleep(3)
    except Exception as ex:
        dbgout('`main -> exception! ' + str(ex) + '`')
